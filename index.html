<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø´Ø¦ Ø§Ù„Ø­Ù‚Ø§Ø¦Ø¨ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #27ae60;
            --accent: #e67e22;
            --bg: #f4f7f6;
        }

        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        
        /* ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© */
        .main-container { display: flex; gap: 20px; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙŠØ³Ø±Ù‰ */
        .control-panel { 
            width: 35%; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            height: 90vh; 
            overflow-y: auto; 
        }

        .unit-form { 
            background: #f9f9f9; 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 5px; 
            border-right: 4px solid var(--secondary);
        }

        .input-group { margin-bottom: 10px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-family: 'Cairo'; }
        textarea { height: 80px; resize: vertical; }

        button { width: 100%; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; margin-top: 5px; }
        .btn-add { background: var(--secondary); color: white; margin-bottom: 20px; }
        .btn-print { background: var(--primary); color: white; font-size: 16px; }
        .btn-del { background: #c0392b; color: white; width: auto; padding: 5px 10px; font-size: 12px; float: left; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ */
        .preview-area { 
            width: 65%; 
            background: #525659; 
            padding: 20px; 
            overflow-y: auto; 
            height: 90vh; 
            display: flex; 
            justify-content: center; 
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙˆØ±Ù‚ Ù„Ù„Ù€ PDF */
        #printable-content {
            background: white;
            width: 210mm; /* A4 width */
            min-height: 297mm;
            padding: 10mm; /* Ù‡Ø§Ù…Ø´ 1 Ø³Ù… */
            box-sizing: border-box;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .cover-page { 
            text-align: center; 
            padding-top: 50mm; 
            page-break-after: always; /* ÙŠØ¬Ø¨Ø± Ø§Ù„ØºÙ„Ø§Ù Ø£Ù† ÙŠÙƒÙˆÙ† ØµÙØ­Ø© Ù…Ø³ØªÙ‚Ù„Ø© */
            min-height: 250mm;
        }
        
        .cover-title { font-size: 32px; color: var(--primary); border-bottom: 3px solid var(--accent); display: inline-block; padding-bottom: 10px; }
        .cover-info { margin-top: 30px; color: #555; font-size: 18px; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ­Ø¯Ø© */
        .unit-section { 
            margin-top: 20px; 
            page-break-before: always; /* ÙƒÙ„ ÙˆØ­Ø¯Ø© ØªØ¨Ø¯Ø£ ÙÙŠ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© */
        }

        .unit-header {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .content-block { margin-bottom: 20px; border-bottom: 1px dashed #eee; padding-bottom: 15px; }
        .block-title { 
            color: var(--secondary); 
            font-weight: bold; 
            font-size: 18px; 
            display: flex; 
            align-items: center; 
            margin-bottom: 8px;
        }
        .block-title::before { content: 'â–ª'; margin-left: 10px; color: var(--accent); font-size: 24px; }
        
        .text-body { line-height: 1.6; text-align: justify; white-space: pre-wrap; }

        /* Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            .control-panel { display: none; }
            .preview-area { width: 100%; background: white; padding: 0; }
            #printable-content { box-shadow: none; width: 100%; }
        }
    </style>
</head>
<body>

<div class="main-container">
    
    <div class="control-panel">
        <h3 style="text-align: center;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©</h3>
        
        <div class="unit-form">
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©</label>
            <input type="text" id="bagTitle" oninput="updateCover()" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">
            <br><br>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨</label>
            <input type="text" id="trainerName" oninput="updateCover()">
        </div>

        <hr>

        <div id="unitsContainer"></div>

        <button class="btn-add" onclick="addNewUnit()">+ Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="btn-print" onclick="generatePDF()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù PDF</button>
    </div>

    <div class="preview-area">
        <div id="printable-content">
            
            <div class="cover-page">
                <h1 class="cover-title" id="dispTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h1>
                <div class="cover-info">
                    <p>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø¨: <span id="dispTrainer">---</span></p>
                    <p>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ 2024</p>
                </div>
            </div>

            <div id="previewUnits"></div>

        </div>
    </div>

</div>

<script>
    let unitCount = 0;

    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©
    function addNewUnit() {
        unitCount++;
        const unitId = unitCount;

        // 1. Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ³Ø±Ù‰
        const formDiv = document.createElement('div');
        formDiv.className = 'unit-form';
        formDiv.id = `form-unit-${unitId}`;
        formDiv.innerHTML = `
            <button class="btn-del" onclick="removeUnit(${unitId})">Ø­Ø°Ù</button>
            <div style="clear:both; margin-bottom:10px;"></div>
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø±Ù‚Ù… ${unitId}</label>
            <input type="text" oninput="updateUnit(${unitId})" id="input-title-${unitId}" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
            
            <label>Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</label>
            <textarea oninput="updateUnit(${unitId})" id="input-content-${unitId}"></textarea>
            
            <label>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ</label>
            <textarea oninput="updateUnit(${unitId})" id="input-activity-${unitId}"></textarea>
            
            <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ø£Ø³Ø¦Ù„Ø©)</label>
            <textarea oninput="updateUnit(${unitId})" id="input-eval-${unitId}"></textarea>
            
            <label>Ù…Ø­ØªÙˆÙ‰ Ø¥Ø«Ø±Ø§Ø¦ÙŠ</label>
            <textarea oninput="updateUnit(${unitId})" id="input-extra-${unitId}"></textarea>
        `;
        document.getElementById('unitsContainer').appendChild(formDiv);

        // 2. Ø¥Ø¶Ø§ÙØ© Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰
        const previewDiv = document.createElement('div');
        previewDiv.className = 'unit-section';
        previewDiv.id = `preview-unit-${unitId}`;
        previewDiv.innerHTML = `
            <div class="unit-header">
                <h2 style="margin:0" id="show-title-${unitId}">Ø§Ù„ÙˆØ­Ø¯Ø© ${unitId}</h2>
            </div>
            
            <div class="content-block">
                <div class="block-title">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</div>
                <div class="text-body" id="show-content-${unitId}">...</div>
            </div>

            <div class="content-block">
                <div class="block-title">ğŸ’¡ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ</div>
                <div class="text-body" id="show-activity-${unitId}">...</div>
            </div>

            <div class="content-block">
                <div class="block-title">ğŸ“ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
                <div class="text-body" id="show-eval-${unitId}">...</div>
            </div>

            <div class="content-block" style="border:none">
                <div class="block-title">ğŸ“š Ù…Ø­ØªÙˆÙ‰ Ø¥Ø«Ø±Ø§Ø¦ÙŠ</div>
                <div class="text-body" id="show-extra-${unitId}">...</div>
            </div>
        `;
        document.getElementById('previewUnits').appendChild(previewDiv);
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
    function updateUnit(id) {
        document.getElementById(`show-title-${id}`).innerText = document.getElementById(`input-title-${id}`).value || `Ø§Ù„ÙˆØ­Ø¯Ø© ${id}`;
        document.getElementById(`show-content-${id}`).innerText = document.getElementById(`input-content-${id}`).value;
        document.getElementById(`show-activity-${id}`).innerText = document.getElementById(`input-activity-${id}`).value;
        document.getElementById(`show-eval-${id}`).innerText = document.getElementById(`input-eval-${id}`).value;
        document.getElementById(`show-extra-${id}`).innerText = document.getElementById(`input-extra-${id}`).value;
    }

    function updateCover() {
        document.getElementById('dispTitle').innerText = document.getElementById('bagTitle').value || 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©';
        document.getElementById('dispTrainer').innerText = document.getElementById('trainerName').value || '---';
    }

    function removeUnit(id) {
        document.getElementById(`form-unit-${id}`).remove();
        document.getElementById(`preview-unit-${id}`).remove();
    }

    // Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø¯Ø© Ø£ÙˆÙ„Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    window.onload = addNewUnit;

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù€ PDF Ù…Ø¹ ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª
    function generatePDF() {
        const element = document.getElementById('printable-content');
        
        const opt = {
            margin:       10, // 10mm = 1cm
            filename:     'training_manual.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, useCORS: true },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak:    { mode: ['css', 'legacy'] } // Ø§Ø­ØªØ±Ø§Ù… ÙÙˆØ§ØµÙ„ Ø§Ù„ØµÙØ­Ø§Øª CSS
        };

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª
        html2pdf().from(element).set(opt).toPdf().get('pdf').then(function (pdf) {
            var totalPages = pdf.internal.getNumberOfPages();

            for (i = 1; i <= totalPages; i++) {
                pdf.setPage(i);
                pdf.setFontSize(10);
                pdf.setTextColor(150);
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„Ø¹Ø±Ø¶/2 ØŒ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ - 10 Ù…Ù…)
                pdf.text('ØµÙØ­Ø© ' + i + ' Ù…Ù† ' + totalPages, pdf.internal.pageSize.getWidth() / 2, pdf.internal.pageSize.getHeight() - 10, { align: 'center' });
            }
        }).save();
    }
</script>

</body>
</html>
